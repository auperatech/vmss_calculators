control_port: 51881
input_stream: "inStream1"

node {
  name: "demux_node"
  calculator: "stream_demux"
  input_stream: "inStream1"
  output_stream: "packetstream1"
  side_node_name: "decode_node"
  node_options: {
    [type.googleapis.com/aup.avaf.StreamMuxOptions]: {
      demux: {
        rtsp_transport: "tcp"  
        iframe_extract: false
        auto_reconnect: true
      }
    }
  }
}

node {
  name: "decode_node"
  calculator: "x86_dec"
  input_stream: "packetstream1"
  output_stream: "imgStream1080p"
  side_node_name: "demux_node"
  node_options: {
    [type.googleapis.com/aup.avaf.VideoCodecOptions]: {
      dec: {
        ow: 1920
        oh: 1080
        opixfmt: "BGR24"
        queue_size: 12
        low_latency: false
      }
    }
  }
}

node {
  name: "box_detector_node"
  calculator: "box_detector"
  input_stream: "imgStream1080p"
  output_stream: "detectionsStream"
  side_node_name: "tracker_node"
  node_options: {
    [type.googleapis.com/aup.avaf.BoxDetectorOptions]: {
      detect_interval: 5
      detector_type: "SSD"
      kernel_name: "RESNET18SSD_ITER140000_4CAR_CLEAN_20211020_v205_vitis1.3"
      need_preprocess: true
      log_performance: true
      run_on_letterboxed_img: false
      include_cvmat_in_meta : true
      label_confidence: {
        label: 1
        confidence: 0.4
      }
      inter_class_nms: {
        labels: 0
        labels: 1
        labels: 2
        threshold: 0.3
      }
    }
  }
}

node {
  name: "tracker_node"
  calculator: "box_tracker"
  input_stream: "detectionsStream"
  input_stream: "imgStream1080p"
  side_node_name: "box_detector_node"
  node_options: {
    [type.googleapis.com/aup.avaf.BoxTrackerOptions]: {
      max_keep_alive: 3
      min_hits: 1
      affinity_threshold: 0.008  
      shape_weight: 1
      position_weight: 1
      appearance_weight: 1
      shape_dist_max: 1
      position_dist_max: 1
      use_exp_cost: true
      tracker_type: "DEEPSORT"
    }
  }
}







  